$7(function(){$7(".tianjia").live("click",function(){addQues+=1;var j=$7(this).parents(".movie_box");j.nextAll().each(function(){var k=$(this).find(".nmb").text();k=parseInt(k)+1;$(this).find(".nmb").text(k)});var h=$7(this).attr("value");var e='<div class="movie_box"></div>';var i=$7(this).parents(".movie_box").children(".tm_btitlt").children(".nmb").text();i=parseInt(i)+1;switch(h){case"0":case"1":case"2":e=$7(e).append('<div class="tm_btitlt"><i class="nmb">'+i+'</i>. <i class="btwenzi">请编辑问题</i></div>');var g='<ul class="wjdc_list"></ul>';var f="";if(h=="0"){f="【单选】"}else{if(h=="1"){f="【多选】"}else{if(h=="2"){f="【判断】"}}}e=$7(e).append(g);e=$7(e).append('<div class="dx_box" data-t="'+h+'"></div>');break}$7(e).hover(function(){var k="<div class='kzqy_czbut'><a href='javascript:void(0)' class='sy'>上移</a><a href='javascript:void(0)'  class='xy'>下移</a><a href='javascript:void(0)'  class='bianji'>编辑</a><a href='javascript:void(0)' class='del' >删除</a></div>";$7(this).css({border:"1px solid #0099ff"});$7(this).children(".wjdc_list").after(k)},function(){$7(this).css({border:"1px solid #fff","border-bottom":"1px solid #eee"});$7(this).children(".kzqy_czbut").remove()});$7(this).parents(".movie_box").after(e);updateTotalNum(this)});$7(".yd_box").on("click",".movie_box .xy",function(){var e=$7(this).parent().parent().parent(".yd_box").children(".movie_box").length;var g=$7(this).parent(".kzqy_czbut").parent(".movie_box").index();if(g<e-1){var f=$7(this).parent(".kzqy_czbut").parent(".movie_box");f.next().after(f);f.find(".nmb").text(f.index()+1);f.prev().find(".nmb").text(f.index())}else{alert("到底了")}});$7(".yd_box").on("click",".movie_box .sy",function(){var f=$7(this).parent(".kzqy_czbut").parent(".movie_box").index();if(f>0){var e=$7(this).parent(".kzqy_czbut").parent(".movie_box");e.prev().before(e);e.find(".nmb").text(e.index()+1);e.next().find(".nmb").text(e.index()+2)}else{alert("到头了")}});$7(".yd_box").on("click",".movie_box .del",function(){var h=confirm("确认删除吗？");if(h){var k=$7(this).parent(".kzqy_czbut").parent(".movie_box").children(".wjdc_list").children("li").length;if(k==0){if(addQues>0){addQues--}}var i=$7(this).parent(".kzqy_czbut").parent(".movie_box");var g=1;i.index();i.nextAll().each(function(){$7(this).find(".nmb");var m=$7(this).find(".nmb").text();m=parseInt(m)-1;$7(this).find(".nmb").text(m)});var l=i.children(".ques_id").prop("id");$7(".el_drag").each(function(){var m=$7(this).children(".ques_id").prop("id");if(l==m){$7(this).children(".el_tiku_checkedButton").removeAttr("checked")}});var f=$7(this).parents(".el_addEPtikuang");var e=f.find(".movie_box").length-1;f.find(".numQues").text("");f.find(".numQues").text(e+"题)");var j=f.find(".el_modifiedGrade").val();e=parseFloat(e);j=parseFloat(j);f.find(".numTotal").text("");f.find(".numTotal").text(e*j+"分;共");i.remove()}});var c;var d;var b;var a=false;$7(".yd_box").on("click",".movie_box .bianji",function(){$7(this).siblings().hide();var q=$7(".danxuan").html();var l=$7(".duoxuan").html();var p=$7(".panduan").html();var e=$7(this).parent(".kzqy_czbut").parent(".movie_box").find(".dx_box");var n=e.attr("data-t");var o=$7(this).parent(".kzqy_czbut").parent(".movie_box").children(".wjdc_list").children("li").length;if(n==0){e.show().html(q);var s=e.find(".title_itram").children(".kzjxx_iteam").length;var f=e.find(".title_itram").children(".kzjxx_iteam").html();for(var j=s;j<o-1;j++){e.find(".title_itram").append("<div class='kzjxx_iteam'>"+f+"</div>")}var k=$7(this).parent(".kzqy_czbut").parent(".movie_box").children(".tm_btitlt").children(".btwenzi").text();e.find(".btwen_text").val(k);var m=0;$7(this).parent(".kzqy_czbut").parent(".movie_box").find(".wjdc_list").children("li").each(function(){if($7(this).find(".el_box_choose").is(":checked")){e.children(".title_itram").children(".kzjxx_iteam").eq(m-1).find(".el_answerRadio").prop("checked","true")}var u=$7(this).find("input").hasClass("wenb_input");if(u){var i=$7(this).index();e.find(".title_itram").children(".kzjxx_iteam").eq(i-1).find("label").remove()}var t=$7(this).find("span").text();e.find(".title_itram").children(".kzjxx_iteam").eq(m-1).find(".input_wenbk").val(t);m++});var r=e.parent().children(".el_answer_analy_box").children(".el_box_analy").text();e.parent().children(".el_answer_analy_box").hide();c=KindEditor.create("#editor_id1",{resizeType:1,allowPreviewEmoticons:false,items:["table","|","fontsize","bold","italic","underline","removeformat","|","justifyleft","justifycenter","justifyright","|","image"]})}if(n==1){e.show().html(l);var s=e.find(".title_itram").children(".kzjxx_iteam").length;var f=e.find(".title_itram").children(".kzjxx_iteam").html();for(var j=s;j<o-1;j++){e.find(".title_itram").append("<div class='kzjxx_iteam'>"+f+"</div>")}var k=$7(this).parent(".kzqy_czbut").parent(".movie_box").children(".tm_btitlt").children(".btwenzi").text();e.find(".btwen_text").val(k);var m=0;$7(this).parent(".kzqy_czbut").parent(".movie_box").find(".wjdc_list").children("li").each(function(){if($7(this).find(".el_box_choose").is(":checked")){e.children(".title_itram").children(".kzjxx_iteam").eq(m-1).find(".el_answerCheck").prop("checked","true")}var u=$7(this).find("input").hasClass("wenb_input");if(u){var i=$7(this).index();e.find(".title_itram").children(".kzjxx_iteam").eq(i-1).find("label").remove()}var t=$7(this).find("span").text();e.find(".title_itram").children(".kzjxx_iteam").eq(m-1).find(".input_wenbk").val(t);m++});var r=e.parent().children(".el_answer_analy_box").children(".el_box_analy").text();e.parent().children(".el_answer_analy_box").hide();d=KindEditor.create("#editor_id2",{resizeType:1,allowPreviewEmoticons:false,items:["table","|","fontsize","bold","italic","underline","removeformat","|","justifyleft","justifycenter","justifyright","|","image"]})}if(n==2){e.show().html(p);var k=$7(this).parent(".kzqy_czbut").parent(".movie_box").children(".tm_btitlt").children(".btwenzi").text();e.find(".btwen_text").val(k);var h=0;var g=0;$7(this).parent(".kzqy_czbut").parent(".movie_box").find(".wjdc_list").children("li").each(function(){if(g>0){if($7(this).find(".el_box_choose").is(":checked")){e.children(".title_itram").children(".kzjxx_iteam").children("#el_panduanChoose").children("li").eq(h).find(".el_answerPanduan").prop("checked","true")}h++}g++});var r=e.parent().children(".el_answer_analy_box").children(".el_box_analy").text();e.parent().children(".el_answer_analy_box").hide();b=KindEditor.create("#editor_id3",{themeType:"simple",resizeType:1,allowPreviewEmoticons:false,items:["table","|","fontsize","bold","italic","underline","removeformat","|","justifyleft","justifycenter","justifyright","|","image"]})}$7(".kzjxx_iteam").hover(function(){var i="<div class='kzqy_czbut'><a href='javascript:void(0)' class='xsy'>上移</a><a href='javascript:void(0)'  class='xxy'>下移</a><a href='javascript:void(0)' class='xdel' >删除</a></div>";if(!($7(this).hasClass("el_panduan_ti"))){$7(this).css({border:"1px solid #0099ff"});$7(this).append(i)}},function(){$7(this).css({border:"1px solid rgb(242,242,242)"});$7(this).children(".kzqy_czbut").remove()})});$7(".zjxx").live("click",function(){var e=$7(this).prev(".title_itram").children(".kzjxx_iteam").html();$7(this).prev(".title_itram").append("<div class='kzjxx_iteam'>"+e+"</div>");$7(".kzjxx_iteam").hover(function(){var f="<div class='kzqy_czbut'><a href='javascript:void(0)'  class='xxy'>下移</a><a href='javascript:void(0)' class='xsy'>上移</a><a href='javascript:void(0)' class='xdel' >删除</a></div>";$7(this).css({border:"1px solid #0099ff"});$7(this).append(f)},function(){$7(this).css({border:"1px solid rgb(242,242,242)"});$7(this).children(".kzqy_czbut").remove()})});$7(".xdel").live("click",function(){var e=confirm("确认删除吗？");if(e){var f=$7(this).parents(".title_itram").children(".kzjxx_iteam").length;if(f>0){$7(this).parents(".kzjxx_iteam").nextAll().each(function(){var g=$(this).children(".option_num").val();g=parseInt(g)-1;$(this).children(".option_num").val(g)});$7(this).parent(".kzqy_czbut").parent(".kzjxx_iteam").remove()}else{alert("手下留情")}}});$7(".xxy").live("click",function(){var e=$7(this).parents(".title_itram").children(".kzjxx_iteam").length;var g=$7(this).parent(".kzqy_czbut").parent(".kzjxx_iteam").index();if(g<e-1){var h=$7(this).parents(".kzjxx_iteam");$7(this).parents(".kzjxx_iteam").next().after(h);var f=$7(this).parents(".kzjxx_iteam").children(".option_num").val();$7(this).parents(".kzjxx_iteam").prev().children(".option_num").val(f);f=parseInt(f)+1;$7(this).parents(".kzjxx_iteam").children(".option_num").val(f)}else{alert("到底了")}});$7(".xsy").live("click",function(){var f=$7(this).parent(".kzqy_czbut").parent(".kzjxx_iteam").index();if(f>0){var g=$7(this).parents(".kzjxx_iteam");$7(this).parents(".kzjxx_iteam").prev().before(g);var e=$7(this).parents(".kzjxx_iteam").children(".option_num").val();$7(this).parents(".kzjxx_iteam").next().children(".option_num").val(e);e=parseInt(e)-1;$7(this).parents(".kzjxx_iteam").children(".option_num").val(e)}else{alert("到头了")}});$7(".dx_box .qxbj_but").live("click",function(){$7(this).parent(".bjqxwc_box").parent(".dx_box").parent(".movie_box").children(".el_answer_analy_box").show();$7(this).parent(".bjqxwc_box").parent(".dx_box").empty().hide();$7(".movie_box").css({border:"1px solid #fff"});$7(".kzqy_czbut").remove()});$7(".swcbj_but").live("click",function(){var q=$7(this).parent(".bjqxwc_box").parent(".dx_box");var g=q.attr("data-t");var u=false;var e=true;var r="";var f=0;switch(g){case"0":var t=q.find(".title_itram").children(".kzjxx_iteam").length;var p=q.parent(".movie_box").children(".wjdc_list").children("li").length-1;var o=$7("#editor_id1").text();c.sync();var l=$7("#editor_id1").val();if(l==null||($7.trim(l).replace("&nbsp;","")=="")){alert("题干不能为空!");e=false;return}q.children(".title_itram").children(".kzjxx_iteam").each(function(){var j=$7(this).children(".el_chooseButton").find(".el_answerRadio").is(":checked");if(j==true){u=true}var i=$7(this).find(".input_wenbk").val();if(i==null||($7.trim(i).replace("&nbsp;","")=="")){e=false}});if(!e||!u){alert("选项或答案不能为空!,请重新编辑");return}var w=q.parent(".movie_box").children(".tm_btitlt").children(".btwenzi").text(l.replace("<br />",""));for(var n=p;n>0;n--){q.parent(".movie_box").children(".wjdc_list").children("li").eq(n).remove()}q.children(".title_itram").children(".kzjxx_iteam").each(function(){var y=$7(this).children(".el_chooseButton").find(".el_answerRadio").is(":checked");var j=$7(this).find(".input_wenbk").val();var x="radio";if(y==true){var i='<li><label><input name="a" class="el_box_choose" type="'+x+'" checked disabled value=""><span>'+j+"</span></label></li>";u=true;r=f}else{var i='<li><label><input name="a" class="el_box_choose" type="'+x+'" disabled value=""><span>'+j+"</span></label></li>"}q.parent(".movie_box").children(".wjdc_list").append(i);f++});q.parent(".movie_box").children(".el_answer_analy_box").remove();q.parent(".movie_box").append('<div class="el_answer_analy_box"></div>');q.parent(".movie_box").children(".el_answer_analy_box").after('答案:<input class="ques_answer" value="'+(r+1)+'" type="hidden"><span class="el_box_answer">'+updateAnswerFormat((r+1).toString(),"12345","ABCDE")+"</span><br/>");addQues-=1;break;case"1":var t=q.find(".title_itram").children(".kzjxx_iteam").length;var p=q.parent(".movie_box").children(".wjdc_list").children("li").length-1;var o=$7("#editor_id2").text();d.sync();var l=$7("#editor_id2").val();if(l==null||($7.trim(l).replace("&nbsp;","")=="")){alert("题干不能为空!");e=false;return}q.children(".title_itram").children(".kzjxx_iteam").each(function(){var x=$7(this).children(".el_chooseButton").find(".el_answerCheck").is(":checked");var i=$7(this).find(".input_wenbk").val();if(i==null||($7.trim(i).replace("&nbsp;","")=="")){e=false;return}var j="checkbox";if(x==true){u=true}});if(!e||!u){alert("选项或答案不能为空!请重新编辑!");return}var w=q.parent(".movie_box").children(".tm_btitlt").children(".btwenzi").text(l);for(var n=p;n>0;n--){q.parent(".movie_box").children(".wjdc_list").children("li").eq(n).remove()}q.children(".title_itram").children(".kzjxx_iteam").each(function(){var y=$7(this).children(".el_chooseButton").find(".el_answerCheck").is(":checked");var j=$7(this).find(".input_wenbk").val();var x="checkbox";if(y==true){var i='<li><label><input name="a" class="el_box_choose" type="'+x+'" checked disabled value=""><span>'+j+"</span></label></li>";u=true;r=r+(f+1)}else{var i='<li><label><input name="a" class="el_box_choose" type="'+x+'" disabled value=""><span>'+j+"</span></label></li>"}q.parent(".movie_box").children(".wjdc_list").append(i);f++});q.parent(".movie_box").children(".el_answer_analy_box").remove();q.parent(".movie_box").append('<div class="el_answer_analy_box"></div>');q.parent(".movie_box").children(".el_answer_analy_box").after('答案:<input class="ques_answer" value="'+r+'" type="hidden"><span class="el_box_answer">'+updateAnswerFormat(r.toString(),"12345","ABCDE")+"</span><br/>");addQues-=1;break;case"2":var o=$7("#editor_id3").text();b.sync();var l=$7("#editor_id3").val();if(l==null||($7.trim(l).replace("&nbsp;","")=="")){alert("题干不能为空!请重新编辑!");e=false;return}$7("#el_panduanChoose").children("li").each(function(){if($7(this).find(".el_answerPanduan").is(":checked")){u=true}});if(!u){alert("答案不能为空!请重新编辑!");return}var w=q.parent(".movie_box").children(".tm_btitlt").children(".btwenzi").text(l);var h=0;q.parent(".movie_box").children(".wjdc_list").children("li").each(function(){if(h>0){$7(this).remove()}h++});var k=1;var v,s;$7("#el_panduanChoose").children("li").each(function(){if($7(this).find(".el_answerPanduan").is(":checked")){if(k==1){v='<li><label><input name="a" class="el_box_choose" checked type="radio" value=""><span>正确</span></label></li>';s='<li><label><input name="a" class="el_box_choose" type="radio" value=""><span>错误</span></label></li>';r=0}else{v='<li><label><input name="a" class="el_box_choose" type="radio" value=""><span>正确</span></label></li>';s='<li><label><input name="a" class="el_box_choose" checked type="radio" value=""><span>错误</span></label></li>';r=1}u=true}k++});q.parent(".movie_box").children(".wjdc_list").append(v);q.parent(".movie_box").children(".wjdc_list").append(s);q.parent(".movie_box").children(".wjdc_list").children("li").eq(0).find(".tm_btitlt").children(".btwenzi").text(w);q.parent(".movie_box").children(".el_answer_analy_box").remove();q.parent(".movie_box").append('<div class="el_answer_analy_box"></div>');q.parent(".movie_box").children(".el_answer_analy_box").after('答案:<input class="ques_answer" value="'+updatePanduanAnswerFormat((r+1))+'" type="hidden"><span class="el_box_answer">'+updatePanduanAnswerFormat((r+1))+"</span><br/>");addQues-=1;break}$7(this).parent(".bjqxwc_box").parent(".dx_box").empty().hide();function m(){var x=$7(this).parent(".kzqy_czbut").parent(".movie_box");var j=x.parent(".yd_box").find(".movie_box").length;var i=1;x.parent(".yd_box").find(".movie_box").each(function(){$7(".yd_box").children(".movie_box").eq(i).find(".nmb").text(i);i++});x.remove()}})});var updateTotalNum=function(d){var a=$(d).parents(".elaquesTitle_father");var b=a.find(".nmb").length;var c=a.find(".el_modifiedGrade").val();a.find(".el_BigTitle").find(".numQues").text(b+"题)");a.find(".el_BigTitle").find(".numTotal").text(parseFloat(c)*parseFloat(b)+"分;共")};function updateAnswerFormat(d,c,a){for(var b=0,e=c.length;b<e;b++){d=d.replace(c.charAt(b),a.charAt(b))}return d}function updatePanduanAnswerFormat(a){if(a==1){return"正确"}else{return"错误"}};